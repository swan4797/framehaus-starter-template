---
// ========================================
// FOOTER COMPONENT - STRATOS BRANDED
// Dynamic content from Stratos CRM brand_settings
// ========================================

import { fetchBrandSettings, getContactInfo, getSocialLinks } from '../lib/brand'
import type { BrandSettings } from '../types/brand'

// Fetch brand settings from Stratos CRM
let brand: BrandSettings
try {
  brand = await fetchBrandSettings()
} catch (error) {
  console.error('[Footer] Error fetching brand settings:', error)
  // Fallback handled by fetchBrandSettings internally
  brand = await fetchBrandSettings()
}

// Extract contact info and social links
const contactInfo = getContactInfo(brand)
const socialLinks = getSocialLinks(brand)

// Check which social links are available
const hasSocialLinks = Object.values(socialLinks).some(link => link)

// Check if logo URL is valid (not a blob URL)
const hasValidLogo = brand.logo_light_url &&
  brand.logo_light_url.trim() !== '' &&
  !brand.logo_light_url.startsWith('blob:')

const currentYear = new Date().getFullYear()
---

<footer class="site-footer">
  <div class="footer-container">
    <!-- Logo -->
    <div class="footer-logo-section">
      <a href="/" class="footer-logo-link" aria-label="Home">
        {hasValidLogo ? (
          <img
            src={brand.logo_light_url}
            alt={brand.business_name || 'Company Logo'}
            class="footer-logo-img"
          />
        ) : (
          <svg class="footer-logo" viewBox="0 0 100 140" xmlns="http://www.w3.org/2000/svg">
            <path d="M50 10 L85 35 L85 80 L50 130 L15 80 L15 35 Z" fill="currentColor" opacity="0.3"/>
            <path d="M50 30 L70 45 L70 75 L50 95 L30 75 L30 45 Z" fill="currentColor"/>
            <circle cx="50" cy="60" r="12" fill="#f6f4f4"/>
          </svg>
        )}
      </a>
    </div>

    <!-- Footer Columns -->
    <div class="footer-content">
      <!-- Menu Column -->
      <div class="footer-column">
        <h3 class="footer-heading">Menu</h3>
        <nav class="footer-nav">
          <a href="/" class="footer-link">Home</a>
          <a href="/about" class="footer-link">About</a>
          <a href="/services" class="footer-link">Services</a>
          <a href="/search" class="footer-link">Properties</a>
          <a href="/insights" class="footer-link">Insights</a>
          <a href="/contact" class="footer-link">Contact</a>
        </nav>
      </div>

      <!-- Social Column (only show if social links exist) -->
      {hasSocialLinks && (
        <div class="footer-column">
          <h3 class="footer-heading">Social</h3>
          <nav class="footer-nav">
            {socialLinks.facebook && (
              <a href={socialLinks.facebook} target="_blank" rel="noopener noreferrer" class="footer-link">
                Facebook
              </a>
            )}
            {socialLinks.instagram && (
              <a href={socialLinks.instagram} target="_blank" rel="noopener noreferrer" class="footer-link">
                Instagram
              </a>
            )}
            {socialLinks.linkedin && (
              <a href={socialLinks.linkedin} target="_blank" rel="noopener noreferrer" class="footer-link">
                LinkedIn
              </a>
            )}
            {socialLinks.twitter && (
              <a href={socialLinks.twitter} target="_blank" rel="noopener noreferrer" class="footer-link">
                Twitter
              </a>
            )}
            {socialLinks.youtube && (
              <a href={socialLinks.youtube} target="_blank" rel="noopener noreferrer" class="footer-link">
                YouTube
              </a>
            )}
            {socialLinks.tiktok && (
              <a href={socialLinks.tiktok} target="_blank" rel="noopener noreferrer" class="footer-link">
                TikTok
              </a>
            )}
          </nav>
        </div>
      )}

      <!-- Contact Column -->
      <div class="footer-column">
        <h3 class="footer-heading">Contact</h3>
        <div class="footer-contact">
          {contactInfo.email && (
            <a href={`mailto:${contactInfo.email}`} class="footer-link">
              {contactInfo.email}
            </a>
          )}
          {contactInfo.phone && (
            <a href={`tel:${contactInfo.phone.replace(/\s/g, '')}`} class="footer-link">
              {contactInfo.phone}
            </a>
          )}
          {contactInfo.addressLines.length > 0 && (
            <div class="footer-address">
              {contactInfo.addressLines.map((line) => (
                <span class="footer-address-line">{line}</span>
              ))}
            </div>
          )}
        </div>
      </div>

      <!-- Legal Column -->
      <div class="footer-column">
        <h3 class="footer-heading">Legal</h3>
        <nav class="footer-nav">
          <a href="/privacy-policy" class="footer-link">Privacy Policy</a>
          <a href="/terms-and-conditions" class="footer-link">Terms & Conditions</a>
          <a href="/cookie-policy" class="footer-link">Cookie Policy</a>
          <a href="/complaints" class="footer-link">Complaints</a>
        </nav>
      </div>
    </div>

    <!-- Massive Brand Name -->
    <div class="footer-brand">
      <h2 class="brand-name" aria-label={brand.business_name || 'Your Estate Agency'}>
        {(brand.business_name || 'Your Estate Agency').toLowerCase()}
      </h2>
    </div>

    <!-- Copyright -->
    <div class="footer-bottom">
      <p class="footer-copyright">
        © {currentYear} {brand.business_name || 'Your Estate Agency'}. All rights reserved.
      </p>
    </div>
  </div>
</footer>

<style lang="scss">
  // ========================================
  // FOOTER - DESIGN SYSTEM
  // Clean, modern marketplace aesthetic
  // ========================================

  // Design tokens
  $accent-coral: #FF5A5F;
  $accent-coral-dark: #E74E52;
  $text-primary: #1A1A1A;
  $bg-white: #FFFFFF;
  $bg-footer: #1A1A1A; // Dark neutral (matches Why Choose Us section)
  $text-footer: #FFFFFF;
  $text-footer-muted: rgba(255, 255, 255, 0.7);
  $border-footer: rgba(255, 255, 255, 0.15);
  $transition-fast: 150ms ease;
  $transition-smooth: 300ms cubic-bezier(0.4, 0, 0.2, 1);
  $container-max-width: 1280px;
  $radius-md: 8px;

  .site-footer {
    background: $bg-footer;
    color: $text-footer;
    padding: 4rem 0 2rem;
    margin-top: auto;
    font-family: 'Inter', system-ui, -apple-system, sans-serif;
  }

  .footer-container {
    max-width: $container-max-width;
    margin: 0 auto;
    padding: 0 1.5rem;
  }

  /* Logo Section */
  .footer-logo-section {
    margin-bottom: 3rem;
  }

  .footer-logo-link {
    display: inline-block;
    transition: opacity $transition-fast;
  }

  .footer-logo-link:hover {
    opacity: 0.8;
  }

  .footer-logo {
    width: 60px;
    height: 85px;
    color: $text-footer;
  }

  .footer-logo-img {
    max-width: 160px;
    max-height: 60px;
    width: auto;
    height: auto;
    object-fit: contain;
  }

  /* Footer Content Grid */
  .footer-content {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 3rem;
    padding-bottom: 3rem;
  }

  .footer-column {
    display: flex;
    flex-direction: column;
    gap: 1.25rem;
  }

  .footer-heading {
    font-size: 0.75rem;
    font-weight: 600;
    letter-spacing: 0.08em;
    text-transform: uppercase;
    color: $text-footer-muted;
    margin: 0;
  }

  /* Navigation */
  .footer-nav {
    display: flex;
    flex-direction: column;
    gap: 0.625rem;
  }

  .footer-link {
    font-size: 0.9375rem;
    font-weight: 500;
    color: $text-footer;
    text-decoration: none;
    transition: color $transition-fast;
    width: fit-content;

    &:hover {
      color: $accent-coral;
    }
  }

  /* Contact Section */
  .footer-contact {
    display: flex;
    flex-direction: column;
    gap: 0.625rem;
  }

  .footer-address {
    font-size: 0.9375rem;
    font-weight: 500;
    color: $text-footer-muted;
    margin: 0;
    line-height: 1.5;
    display: flex;
    flex-direction: column;
    gap: 0.25rem;
  }

  .footer-address-line {
    display: block;
  }

  /* Massive Brand Name */
  .footer-brand {
    padding: 2.5rem 0;
    overflow: hidden;
  }

  .brand-name {
    font-size: clamp(3rem, 12vw, 10rem);
    font-weight: 800;
    line-height: 0.9;
    color: $text-footer;
    margin: 0;
    letter-spacing: -0.03em;
    text-transform: lowercase;
    word-break: break-word;
    // Initial state - hidden
    opacity: 0;
    transform: translateY(50px);
    transition: opacity 0.8s $transition-smooth,
                transform 0.8s $transition-smooth;
  }

  // Animated state when visible
  .brand-name.animate-in {
    opacity: 1;
    transform: translateY(0);
  }

  @keyframes fadeUp {
    from {
      opacity: 0;
      transform: translateY(50px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  .brand-name.use-keyframe {
    animation: fadeUp 0.8s $transition-smooth forwards;
  }

  /* Bottom Bar */
  .footer-bottom {
    padding-top: 2rem;
    border-top: 1px solid $border-footer;
    display: flex;
    justify-content: center;
    align-items: center;
  }

  .footer-copyright {
    font-size: 0.875rem;
    color: $text-footer-muted;
    margin: 0;
    text-align: center;
  }

  /* Responsive Design */
  @media (max-width: 1024px) {
    .footer-content {
      grid-template-columns: repeat(2, 1fr);
      gap: 2.5rem 2rem;
    }

    .brand-name {
      font-size: clamp(2.5rem, 10vw, 8rem);
    }
  }

  @media (max-width: 768px) {
    .site-footer {
      padding: 3rem 0 1.5rem;
    }

    .footer-logo-section {
      margin-bottom: 2.5rem;
    }

    .footer-logo {
      width: 50px;
      height: 71px;
    }

    .footer-content {
      grid-template-columns: 1fr;
      gap: 2rem;
      padding-bottom: 2.5rem;
    }

    .footer-brand {
      padding: 2rem 0;
    }

    .brand-name {
      font-size: clamp(2rem, 12vw, 6rem);
    }
  }

  @media (max-width: 480px) {
    .footer-container {
      padding: 0 1rem;
    }

    .footer-logo {
      width: 44px;
      height: 62px;
    }

    .footer-heading {
      font-size: 0.6875rem;
    }

    .footer-link,
    .footer-address {
      font-size: 0.875rem;
    }

    .brand-name {
      font-size: clamp(1.75rem, 14vw, 5rem);
    }

    .footer-copyright {
      font-size: 0.8125rem;
    }
  }

  /* Print Styles */
  @media print {
    .site-footer {
      background: white;
      color: black;
      padding: 1rem 0;
    }

    .footer-brand {
      display: none;
    }

    .footer-logo {
      width: 40px;
      height: 57px;
    }
  }

  /* Accessibility */
  @media (prefers-reduced-motion: reduce) {
    .footer-link,
    .footer-logo-link {
      transition: none;
    }

    .brand-name {
      opacity: 1 !important;
      transform: none !important;
      transition: none !important;
      animation: none !important;
    }
  }
</style>

<script>
  // ✅ TRACKING: Track footer link clicks
  document.addEventListener('DOMContentLoaded', () => {
    const footerLinks = document.querySelectorAll('.site-footer .footer-link')
    
    footerLinks.forEach(link => {
      link.addEventListener('click', (e) => {
        const href = (e.currentTarget as HTMLAnchorElement).getAttribute('href')
        const text = (e.currentTarget as HTMLAnchorElement).textContent?.trim()
        
        if (window.StratosTracker && href && text) {
          window.StratosTracker.trackEvent('footer_link_click', {
            link_text: text,
            link_href: href,
            link_type: href.startsWith('http') ? 'external' : 'internal'
          })
        }
      })
    })

    // ✅ ANIMATION: Fade-up brand name when it enters viewport
    const brandName = document.querySelector('.brand-name')
    
    if (brandName) {
      // Create intersection observer
      const observer = new IntersectionObserver(
        (entries) => {
          entries.forEach(entry => {
            if (entry.isIntersecting) {
              // Element is visible, trigger animation
              entry.target.classList.add('animate-in')
              
              // Optional: Stop observing after animation triggers once
              observer.unobserve(entry.target)
            }
          })
        },
        {
          // Trigger when 20% of element is visible
          threshold: 0.2,
          // Start observing 100px before element enters viewport
          rootMargin: '0px 0px -100px 0px'
        }
      )

      // Start observing the brand name
      observer.observe(brandName)
    }

    console.log('✅ Footer tracking initialized')
    console.log('✅ Footer brand animation initialized')
  })
</script>