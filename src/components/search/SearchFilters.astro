---
// ========================================
// SEARCH FILTERS COMPONENT
// Filters for property search page
// ========================================

import type { PropertySearchParams } from '../../types/database'

interface Props {
  currentParams: PropertySearchParams
}

const { currentParams } = Astro.props

// Get current values with fallbacks
const listingType = currentParams.listing_type || 'sale'
const location = currentParams.location || ''
const minPrice = currentParams.min_price || ''
const maxPrice = currentParams.max_price || ''
const beds = currentParams.beds || ''
const propertyType = currentParams.property_type || ''

// Price ranges for sale
const salePriceRanges = [
  { value: '', label: 'No min' },
  { value: '100000', label: '£100,000' },
  { value: '150000', label: '£150,000' },
  { value: '200000', label: '£200,000' },
  { value: '250000', label: '£250,000' },
  { value: '300000', label: '£300,000' },
  { value: '400000', label: '£400,000' },
  { value: '500000', label: '£500,000' },
  { value: '750000', label: '£750,000' },
  { value: '1000000', label: '£1,000,000' },
]

// Price ranges for rent (monthly)
const rentPriceRanges = [
  { value: '', label: 'No min' },
  { value: '500', label: '£500' },
  { value: '750', label: '£750' },
  { value: '1000', label: '£1,000' },
  { value: '1250', label: '£1,250' },
  { value: '1500', label: '£1,500' },
  { value: '2000', label: '£2,000' },
  { value: '2500', label: '£2,500' },
  { value: '3000', label: '£3,000' },
  { value: '5000', label: '£5,000' },
]

const maxPriceRanges = listingType === 'sale' 
  ? [...salePriceRanges.slice(1), { value: '', label: 'No max' }]
  : [...rentPriceRanges.slice(1), { value: '', label: 'No max' }]

const propertyTypes = [
  { value: '', label: 'All Types' },
  { value: 'detached', label: 'Detached' },
  { value: 'semi-detached', label: 'Semi-Detached' },
  { value: 'terraced', label: 'Terraced' },
  { value: 'flat', label: 'Flat' },
  { value: 'apartment', label: 'Apartment' },
  { value: 'bungalow', label: 'Bungalow' },
  { value: 'cottage', label: 'Cottage' },
]

const bedroomOptions = [
  { value: '', label: 'Any' },
  { value: '1', label: '1+' },
  { value: '2', label: '2+' },
  { value: '3', label: '3+' },
  { value: '4', label: '4+' },
  { value: '5', label: '5+' },
]
---

<form method="get" action="/search" class="bg-white rounded-lg shadow-md p-6">
  <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mb-4">
    <!-- Listing Type -->
    <div class="lg:col-span-3">
      <label class="block text-sm font-medium text-gray-700 mb-2">
        I'm looking to...
      </label>
      <div class="flex gap-4">
        <label class="flex items-center">
          <input
            type="radio"
            name="listing_type"
            value="sale"
            checked={listingType === 'sale'}
            class="mr-2"
          />
          <span class="text-sm">Buy</span>
        </label>
        <label class="flex items-center">
          <input
            type="radio"
            name="listing_type"
            value="let"
            checked={listingType === 'let'}
            class="mr-2"
          />
          <span class="text-sm">Rent</span>
        </label>
      </div>
    </div>

    <!-- Location -->
    <div class="lg:col-span-3">
      <label for="location" class="block text-sm font-medium text-gray-700 mb-2">
        Location
      </label>
      <input
        type="text"
        id="location"
        name="location"
        value={location}
        placeholder="e.g. London, SW16, Streatham"
        class="w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
      />
    </div>

    <!-- Min Price -->
    <div>
      <label for="min_price" class="block text-sm font-medium text-gray-700 mb-2">
        Min Price
      </label>
      <select
        id="min_price"
        name="min_price"
        class="w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
      >
        {(listingType === 'sale' ? salePriceRanges : rentPriceRanges).map(range => (
          <option value={range.value} selected={minPrice.toString() === range.value}>
            {range.label}
          </option>
        ))}
      </select>
    </div>

    <!-- Max Price -->
    <div>
      <label for="max_price" class="block text-sm font-medium text-gray-700 mb-2">
        Max Price
      </label>
      <select
        id="max_price"
        name="max_price"
        class="w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
      >
        {maxPriceRanges.map(range => (
          <option value={range.value} selected={maxPrice.toString() === range.value}>
            {range.label}
          </option>
        ))}
      </select>
    </div>

    <!-- Bedrooms -->
    <div>
      <label for="beds" class="block text-sm font-medium text-gray-700 mb-2">
        Bedrooms
      </label>
      <select
        id="beds"
        name="beds"
        class="w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
      >
        {bedroomOptions.map(option => (
          <option value={option.value} selected={beds.toString() === option.value}>
            {option.label}
          </option>
        ))}
      </select>
    </div>

    <!-- Property Type -->
    <div class="lg:col-span-2">
      <label for="property_type" class="block text-sm font-medium text-gray-700 mb-2">
        Property Type
      </label>
      <select
        id="property_type"
        name="property_type"
        class="w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
      >
        {propertyTypes.map(type => (
          <option value={type.value} selected={propertyType === type.value}>
            {type.label}
          </option>
        ))}
      </select>
    </div>
  </div>

  <!-- Buttons -->
  <div class="flex gap-3">
    <button
      type="submit"
      class="flex-1 bg-blue-600 text-white font-medium py-3 px-6 rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-colors"
    >
      Search Properties
    </button>
    <a
      href="/search"
      class="px-6 py-3 border border-gray-300 text-gray-700 font-medium rounded-md hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-colors"
    >
      Reset
    </a>
  </div>
</form>

<script>
  // Update price ranges when listing type changes
  document.addEventListener('DOMContentLoaded', () => {
    const form = document.querySelector('form')
    const listingTypeInputs = document.querySelectorAll('input[name="listing_type"]')
    
    if (form && listingTypeInputs.length > 0) {
      listingTypeInputs.forEach(input => {
        input.addEventListener('change', () => {
          // Clear price filters when switching listing type
          const minPriceSelect = form.querySelector('#min_price') as HTMLSelectElement
          const maxPriceSelect = form.querySelector('#max_price') as HTMLSelectElement
          
          if (minPriceSelect) minPriceSelect.value = ''
          if (maxPriceSelect) maxPriceSelect.value = ''
        })
      })
    }
  })
</script>