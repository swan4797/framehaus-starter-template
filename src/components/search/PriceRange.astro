---
interface Props {
  listingType?: string
  minPrice?: number
  maxPrice?: number
}

const { listingType = 'sale', minPrice, maxPrice } = Astro.props

const salePrices = [50000, 75000, 100000, 125000, 150000, 175000, 200000, 250000, 300000, 350000, 400000, 450000, 500000, 600000, 700000, 800000, 900000, 1000000, 1250000, 1500000, 2000000]
const rentPrices = [400, 500, 600, 700, 800, 900, 1000, 1250, 1500, 1750, 2000, 2500, 3000, 3500, 4000, 5000]

const prices = listingType === 'sale' ? salePrices : rentPrices
const formatPrice = (price: number) => {
  return listingType === 'sale' 
    ? `£${(price / 1000).toFixed(0)}k`
    : `£${price}/pcm`
}
---

<div class="relative">
  <button
    type="button"
    id="price-range-btn"
    class="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:border-[#064728] focus:ring-4 focus:ring-[#064728]/10 outline-none transition-all text-left flex items-center justify-between"
  >
    <span id="price-range-label" class="text-gray-700">
      {minPrice || maxPrice ? 
        `${minPrice ? formatPrice(minPrice) : 'No min'} - ${maxPrice ? formatPrice(maxPrice) : 'No max'}` 
        : 'Price range'}
    </span>
    <svg class="h-5 w-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
    </svg>
  </button>

  <!-- Dropdown -->
  <div 
    id="price-range-dropdown"
    class="absolute z-50 w-80 mt-2 bg-white rounded-lg shadow-lg border border-gray-200 hidden"
  >
    <div class="p-4 space-y-4">
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-2">Minimum</label>
        <select
          name="min_price"
          id="min-price-select"
          class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#064728] focus:border-[#064728]"
        >
          <option value="">No min</option>
          {prices.map(price => (
            <option value={price} selected={minPrice === price}>
              {formatPrice(price)}
            </option>
          ))}
        </select>
      </div>

      <div>
        <label class="block text-sm font-medium text-gray-700 mb-2">Maximum</label>
        <select
          name="max_price"
          id="max-price-select"
          class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#064728] focus:border-[#064728]"
        >
          <option value="">No max</option>
          {prices.map(price => (
            <option value={price} selected={maxPrice === price}>
              {formatPrice(price)}
            </option>
          ))}
        </select>
      </div>

      <button
        type="button"
        id="price-range-apply"
        class="w-full px-4 py-2 bg-[#064728] text-white rounded-lg hover:bg-[#0a5c35] transition-colors font-medium"
      >
        Apply
      </button>
    </div>
  </div>
</div>

<script>
  const btn = document.getElementById('price-range-btn')
  const dropdown = document.getElementById('price-range-dropdown')
  const label = document.getElementById('price-range-label')
  const applyBtn = document.getElementById('price-range-apply')
  const minSelect = document.getElementById('min-price-select') as HTMLSelectElement
  const maxSelect = document.getElementById('max-price-select') as HTMLSelectElement

  btn?.addEventListener('click', () => {
    dropdown?.classList.toggle('hidden')
  })

  applyBtn?.addEventListener('click', () => {
    updateLabel()
    dropdown?.classList.add('hidden')
  })

  function updateLabel() {
    if (!label || !minSelect || !maxSelect) return

    const minVal = minSelect.value
    const maxVal = maxSelect.value
    const minText = minSelect.options[minSelect.selectedIndex].text
    const maxText = maxSelect.options[maxSelect.selectedIndex].text

    if (minVal || maxVal) {
      label.textContent = `${minVal ? minText : 'No min'} - ${maxVal ? maxText : 'No max'}`
    } else {
      label.textContent = 'Price range'
    }
  }

  // Close on click outside
  document.addEventListener('click', (e) => {
    if (!btn?.contains(e.target as Node) && !dropdown?.contains(e.target as Node)) {
      dropdown?.classList.add('hidden')
    }
  })
</script>