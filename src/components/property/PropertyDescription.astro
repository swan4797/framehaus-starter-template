---
interface Props {
  description: string
}

const { description } = Astro.props

// Split description into paragraphs
const paragraphs = description.split('\n\n').filter(p => p.trim())
const isLong = description.length > 500
---

<div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6">
  <h3 class="text-xl font-bold text-gray-900 mb-4">Property Description</h3>

  <div id="description-content" class={isLong ? 'relative max-h-64 overflow-hidden' : ''}>
    <div class="prose max-w-none text-gray-700">
      {paragraphs.map(paragraph => (
        <p class="mb-4 leading-relaxed">{paragraph}</p>
      ))}
    </div>

    {isLong && (
      <div id="description-fade" class="absolute bottom-0 left-0 right-0 h-24 bg-gradient-to-t from-white to-transparent pointer-events-none"></div>
    )}
  </div>

  {isLong && (
    <button
      type="button"
      id="description-toggle"
      class="mt-4 text-[#064728] font-medium hover:text-[#0a5c35] flex items-center gap-2 transition-colors"
    >
      <span id="toggle-text">Read more</span>
      <svg id="toggle-icon" class="h-5 w-5 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
      </svg>
    </button>
  )}
</div>

<script>
  const content = document.getElementById('description-content')
  const toggle = document.getElementById('description-toggle')
  const toggleText = document.getElementById('toggle-text')
  const toggleIcon = document.getElementById('toggle-icon')
  const fade = document.getElementById('description-fade')

  let expanded = false

  toggle?.addEventListener('click', () => {
    expanded = !expanded

    if (expanded) {
      content?.classList.remove('max-h-64', 'overflow-hidden')
      fade?.classList.add('hidden')
      if (toggleText) toggleText.textContent = 'Read less'
      toggleIcon?.classList.add('rotate-180')
    } else {
      content?.classList.add('max-h-64', 'overflow-hidden')
      fade?.classList.remove('hidden')
      if (toggleText) toggleText.textContent = 'Read more'
      toggleIcon?.classList.remove('rotate-180')
    }
  })
</script>