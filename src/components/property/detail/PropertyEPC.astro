---
// ========================================
// PROPERTY EPC COMPONENT
// Standalone EPC rating display
// ========================================

export interface EPCMedia {
  file_url: string
  alt_text?: string
}

export interface Props {
  rating?: string
  currentScore?: number
  potentialScore?: number
  images?: EPCMedia[]
  propertyAddress?: string
  class?: string
}

const {
  rating,
  currentScore,
  potentialScore,
  images = [],
  propertyAddress = 'this property',
  class: className,
} = Astro.props

const hasData = rating || currentScore || images.length > 0

// EPC rating colors
const getRatingColor = (r: string) => {
  const colors: Record<string, string> = {
    A: '#00843D',
    B: '#2DB24E',
    C: '#99CA3C',
    D: '#FFD500',
    E: '#FCAA00',
    F: '#EF7E00',
    G: '#E30613',
  }
  return colors[r?.toUpperCase()] || '#9CA3AF'
}
---

{hasData && (
  <section class:list={['property-epc', className]}>
    <h2 class="property-epc__title">Energy Performance</h2>

    <div class="property-epc__content">
      {/* EPC Summary */}
      {(rating || currentScore) && (
        <div class="property-epc__summary">
          {rating && (
            <div class="property-epc__rating" style={`--rating-color: ${getRatingColor(rating)}`}>
              <span class="property-epc__badge">{rating.toUpperCase()}</span>
              <span class="property-epc__label">EPC Rating</span>
            </div>
          )}

          {currentScore && (
            <div class="property-epc__score">
              <span class="property-epc__score-value">{currentScore}</span>
              <span class="property-epc__score-label">Current Score</span>
            </div>
          )}

          {potentialScore && (
            <div class="property-epc__score">
              <span class="property-epc__score-value">{potentialScore}</span>
              <span class="property-epc__score-label">Potential Score</span>
            </div>
          )}
        </div>
      )}

      {/* EPC Certificate Images */}
      {images.length > 0 && (
        <div class="property-epc__certificates">
          {images.map((media) => (
            <a
              href={media.file_url}
              target="_blank"
              rel="noopener noreferrer"
              class="property-epc__certificate"
            >
              <img
                src={media.file_url}
                alt={media.alt_text || `EPC Certificate for ${propertyAddress}`}
                loading="lazy"
              />
            </a>
          ))}
        </div>
      )}
    </div>
  </section>
)}

<style lang="scss">
  @use '../../../styles/variables' as *;

  .property-epc {
    margin-bottom: 2rem;
  }

  .property-epc__title {
    font-size: 1.25rem;
    font-weight: 600;
    color: var(--color-text-primary);
    margin: 0 0 1.25rem 0;
  }

  .property-epc__content {
    background: var(--color-bg-secondary);
    border-radius: var(--radius-lg);
    padding: 1.5rem;
  }

  // ----------------------------------------
  // SUMMARY
  // ----------------------------------------

  .property-epc__summary {
    display: flex;
    gap: 2rem;
    flex-wrap: wrap;
    margin-bottom: 1.5rem;
  }

  .property-epc__rating {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 0.5rem;
  }

  .property-epc__badge {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 3.5rem;
    height: 3.5rem;
    font-size: 1.75rem;
    font-weight: 700;
    color: white;
    background-color: var(--rating-color, #9CA3AF);
    border-radius: var(--radius-md);
  }

  .property-epc__label {
    font-size: 0.8125rem;
    font-weight: 500;
    color: var(--color-text-muted);
  }

  .property-epc__score {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 0.375rem;
  }

  .property-epc__score-value {
    font-size: 1.5rem;
    font-weight: 700;
    color: var(--color-text-primary);
  }

  .property-epc__score-label {
    font-size: 0.8125rem;
    font-weight: 500;
    color: var(--color-text-muted);
  }

  // ----------------------------------------
  // CERTIFICATES
  // ----------------------------------------

  .property-epc__certificates {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 1rem;
  }

  .property-epc__certificate {
    display: block;
    border-radius: var(--radius-md);
    overflow: hidden;
    border: 1px solid var(--color-border-light);
    transition: transform var(--transition-fast), box-shadow var(--transition-fast);

    &:hover {
      transform: translateY(-2px);
      box-shadow: var(--shadow-md);
    }

    img {
      width: 100%;
      height: auto;
      display: block;
    }
  }

  // ----------------------------------------
  // RESPONSIVE
  // ----------------------------------------

  @media (max-width: 640px) {
    .property-epc__content {
      padding: 1rem;
    }

    .property-epc__summary {
      gap: 1.5rem;
    }
  }
</style>
