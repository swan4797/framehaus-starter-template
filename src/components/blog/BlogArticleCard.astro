---
// ========================================
// BLOG ARTICLE CARD COMPONENT
// Clean, modern blog card matching template design
// ========================================

import type { BlogArticle } from '../../types/database'

interface Props {
  article: BlogArticle
  featured?: boolean
}

const { article, featured = false } = Astro.props

// Format date
const formatDate = (dateString: string | null) => {
  if (!dateString) return ''
  const date = new Date(dateString)
  return date.toLocaleDateString('en-GB', {
    day: 'numeric',
    month: 'short',
    year: 'numeric'
  })
}

// Default image if no featured image
const imageUrl = article.featured_image_url || 'https://images.unsplash.com/photo-1486312338219-ce68d2c6f44d?w=800&h=500&fit=crop'
const authorImage = article.author?.profile_photo_url || `https://ui-avatars.com/api/?name=${encodeURIComponent(article.author?.full_name || 'Author')}&size=80&background=FF5A5F&color=fff`

// Calculate reading time
const readingTime = Math.ceil((article.content?.length || 0) / 1500)
---

<article
  class:list={[
    'blog-card',
    { 'blog-card--featured': featured || article.is_featured }
  ]}
  data-article-id={article.article_id}
>
  <a href={`/blog/${article.slug}`} class="blog-card__link">
    <!-- Image Container -->
    <div class="blog-card__image-container">
      <img
        src={imageUrl}
        alt={article.featured_image_alt || article.title}
        class="blog-card__image"
        loading="lazy"
      />

      <!-- Featured Badge -->
      {(featured || article.is_featured) && (
        <div class="blog-card__badge">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon>
          </svg>
          Featured
        </div>
      )}

      <!-- Categories -->
      {article.categories && article.categories.length > 0 && (
        <div class="blog-card__categories">
          {article.categories.slice(0, 2).map(cat => (
            <span class="blog-card__category">{cat.name}</span>
          ))}
        </div>
      )}

      <!-- Reading Time -->
      <div class="blog-card__reading-time">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <circle cx="12" cy="12" r="10"/>
          <polyline points="12 6 12 12 16 14"/>
        </svg>
        {readingTime} min
      </div>
    </div>

    <!-- Content -->
    <div class="blog-card__content">
      <!-- Meta Info -->
      <div class="blog-card__meta">
        <time datetime={article.published_at || ''} class="blog-card__date">
          {formatDate(article.published_at)}
        </time>
        {article.view_count > 0 && (
          <span class="blog-card__views">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z"/>
              <circle cx="12" cy="12" r="3"/>
            </svg>
            {article.view_count}
          </span>
        )}
      </div>

      <!-- Title -->
      <h3 class="blog-card__title">{article.title}</h3>

      <!-- Excerpt -->
      {article.excerpt && (
        <p class="blog-card__excerpt">{article.excerpt}</p>
      )}

      <!-- Footer -->
      <div class="blog-card__footer">
        <!-- Author -->
        {article.author && (
          <div class="blog-card__author">
            <img
              src={authorImage}
              alt={article.author.full_name}
              class="blog-card__author-avatar"
              loading="lazy"
            />
            <div class="blog-card__author-details">
              <span class="blog-card__author-name">{article.author.full_name}</span>
              {article.author.job_title && (
                <span class="blog-card__author-title">{article.author.job_title}</span>
              )}
            </div>
          </div>
        )}

        <span class="blog-card__read-more">
          Read Article
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <line x1="5" x2="19" y1="12" y2="12"></line>
            <polyline points="12 5 19 12 12 19"></polyline>
          </svg>
        </span>
      </div>
    </div>
  </a>
</article>

<style lang="scss">
  // ========================================
  // DESIGN TOKENS
  // ========================================

  $accent-coral: #FF5A5F;
  $accent-coral-hover: #E74E52;
  $text-primary: #1A1A1A;
  $text-secondary: #6B7280;
  $text-muted: #9CA3AF;
  $bg-white: #FFFFFF;
  $bg-off-white: #FAFAFA;
  $bg-light: #F5F5F5;
  $border-light: #E5E7EB;

  $radius-md: 12px;
  $radius-lg: 16px;
  $radius-full: 9999px;

  $shadow-card: 0 4px 24px rgba(0, 0, 0, 0.06);
  $shadow-card-hover: 0 12px 32px rgba(0, 0, 0, 0.1);

  $transition-fast: 150ms ease;
  $transition-base: 200ms ease;
  $transition-slow: 400ms cubic-bezier(0.4, 0, 0.2, 1);

  $font-family: 'Inter', system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;

  // ========================================
  // CARD CONTAINER
  // ========================================

  .blog-card {
    position: relative;
    background: $bg-white;
    border-radius: $radius-lg;
    overflow: hidden;
    box-shadow: $shadow-card;
    transition: transform $transition-base, box-shadow $transition-base;
    font-family: $font-family;

    &:hover {
      transform: translateY(-4px);
      box-shadow: $shadow-card-hover;
    }

    &--featured {
      box-shadow: 0 4px 16px rgba($accent-coral, 0.15);

      &:hover {
        box-shadow: 0 12px 36px rgba($accent-coral, 0.2);
      }
    }
  }

  .blog-card__link {
    display: flex;
    flex-direction: column;
    height: 100%;
    text-decoration: none;
    color: inherit;
  }

  // ========================================
  // IMAGE SECTION
  // ========================================

  .blog-card__image-container {
    position: relative;
    aspect-ratio: 16 / 10;
    overflow: hidden;
    background: $bg-light;
  }

  .blog-card__image {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform $transition-slow;

    .blog-card:hover & {
      transform: scale(1.05);
    }
  }

  // ========================================
  // FEATURED BADGE
  // ========================================

  .blog-card__badge {
    position: absolute;
    top: 12px;
    left: 12px;
    display: inline-flex;
    align-items: center;
    gap: 6px;
    padding: 8px 12px;
    background: $accent-coral;
    color: $bg-white;
    font-size: 0.75rem;
    font-weight: 600;
    border-radius: 8px;
    box-shadow: 0 2px 8px rgba($accent-coral, 0.3);
    z-index: 10;

    svg {
      width: 12px;
      height: 12px;
    }
  }

  // ========================================
  // CATEGORIES
  // ========================================

  .blog-card__categories {
    position: absolute;
    bottom: 12px;
    left: 12px;
    display: flex;
    gap: 6px;
    flex-wrap: wrap;
  }

  .blog-card__category {
    display: inline-block;
    padding: 4px 10px;
    font-size: 0.6875rem;
    font-weight: 600;
    background: rgba($accent-coral, 0.9);
    color: $bg-white;
    border-radius: $radius-full;
  }

  // ========================================
  // READING TIME
  // ========================================

  .blog-card__reading-time {
    position: absolute;
    bottom: 12px;
    right: 12px;
    display: flex;
    align-items: center;
    gap: 4px;
    padding: 4px 8px;
    font-size: 0.6875rem;
    font-weight: 500;
    background: rgba(0, 0, 0, 0.6);
    color: $bg-white;
    border-radius: 4px;
    backdrop-filter: blur(4px);

    svg {
      width: 12px;
      height: 12px;
    }
  }

  // ========================================
  // CONTENT SECTION
  // ========================================

  .blog-card__content {
    display: flex;
    flex-direction: column;
    padding: 20px;
    flex: 1;
  }

  // ========================================
  // META INFO
  // ========================================

  .blog-card__meta {
    display: flex;
    align-items: center;
    gap: 16px;
    font-size: 0.8125rem;
    color: $text-muted;
    margin-bottom: 12px;
  }

  .blog-card__date {
    font-weight: 500;
  }

  .blog-card__views {
    display: flex;
    align-items: center;
    gap: 4px;

    svg {
      width: 12px;
      height: 12px;
    }
  }

  // ========================================
  // TITLE
  // ========================================

  .blog-card__title {
    font-size: 1.125rem;
    font-weight: 700;
    color: $text-primary;
    line-height: 1.4;
    margin: 0 0 12px 0;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
    letter-spacing: -0.01em;
    transition: color $transition-fast;

    .blog-card:hover & {
      color: $accent-coral;
    }
  }

  // ========================================
  // EXCERPT
  // ========================================

  .blog-card__excerpt {
    font-size: 0.875rem;
    color: $text-secondary;
    line-height: 1.6;
    margin: 0;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
    flex: 1;
  }

  // ========================================
  // FOOTER
  // ========================================

  .blog-card__footer {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding-top: 16px;
    border-top: 1px solid $border-light;
    margin-top: auto;
  }

  // ========================================
  // AUTHOR
  // ========================================

  .blog-card__author {
    display: flex;
    align-items: center;
    gap: 10px;
  }

  .blog-card__author-avatar {
    width: 32px;
    height: 32px;
    border-radius: 50%;
    object-fit: cover;
  }

  .blog-card__author-details {
    display: flex;
    flex-direction: column;
  }

  .blog-card__author-name {
    font-size: 0.8125rem;
    font-weight: 600;
    color: $text-primary;
    line-height: 1.2;
  }

  .blog-card__author-title {
    font-size: 0.6875rem;
    color: $text-muted;
    line-height: 1.2;
  }

  // ========================================
  // READ MORE
  // ========================================

  .blog-card__read-more {
    display: flex;
    align-items: center;
    gap: 6px;
    font-size: 0.875rem;
    font-weight: 600;
    color: $accent-coral;
    transition: gap $transition-fast;

    svg {
      width: 14px;
      height: 14px;
      transition: transform $transition-fast;
    }

    .blog-card:hover & {
      gap: 10px;

      svg {
        transform: translateX(2px);
      }
    }
  }

  // ========================================
  // RESPONSIVE
  // ========================================

  @media (max-width: 640px) {
    .blog-card__image-container {
      aspect-ratio: 16 / 9;
    }

    .blog-card__content {
      padding: 16px;
    }

    .blog-card__title {
      font-size: 1rem;
    }

    .blog-card__author-avatar {
      width: 28px;
      height: 28px;
    }
  }
</style>
