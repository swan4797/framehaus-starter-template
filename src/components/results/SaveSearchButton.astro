---
interface Props {
  searchParams: any
}

const { searchParams } = Astro.props
---

<button
  type="button"
  id="save-search-btn"
  class="inline-flex items-center gap-2 px-4 py-2 border-2 border-gray-300 rounded-lg hover:border-[#064728] hover:bg-[#064728]/5 transition-all text-gray-700 hover:text-[#064728] font-medium"
>
  <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9" />
  </svg>
  <span id="save-search-text">Save search</span>
</button>

<script>
  const btn = document.getElementById('save-search-btn')
  const text = document.getElementById('save-search-text')
  
  // Check if search is already saved
  const savedSearches = JSON.parse(localStorage.getItem('saved-searches') || '[]')
  const currentSearch = new URLSearchParams(window.location.search).toString()
  const isSaved = savedSearches.some((s: any) => s.params === currentSearch)
  
  if (isSaved && text) {
    text.textContent = 'Search saved ✓'
    btn?.classList.add('border-[#064728]', 'bg-[#064728]/10', 'text-[#064728]')
  }
  
  btn?.addEventListener('click', () => {
    if (isSaved) {
      // Remove from saved
      const filtered = savedSearches.filter((s: any) => s.params !== currentSearch)
      localStorage.setItem('saved-searches', JSON.stringify(filtered))
      
      if (text) text.textContent = 'Save search'
      btn.classList.remove('border-[#064728]', 'bg-[#064728]/10', 'text-[#064728]')
    } else {
      // Add to saved
      savedSearches.push({
        params: currentSearch,
        url: window.location.href,
        timestamp: new Date().toISOString(),
        label: buildSearchLabel()
      })
      localStorage.setItem('saved-searches', JSON.stringify(savedSearches))
      
      if (text) text.textContent = 'Search saved ✓'
      btn.classList.add('border-[#064728]', 'bg-[#064728]/10', 'text-[#064728]')
      
      // Show success message
      showToast('Search saved! You can view your saved searches in your account.')
    }
  })
  
  function buildSearchLabel() {
    const params = new URLSearchParams(window.location.search)
    const parts = []
    
    if (params.get('location')) parts.push(params.get('location'))
    if (params.get('type')) parts.push(params.get('type') === 'sale' ? 'For Sale' : 'To Rent')
    if (params.get('min_beds')) parts.push(`${params.get('min_beds')}+ beds`)
    
    return parts.join(' • ') || 'Property search'
  }
  
  function showToast(message: string) {
    const toast = document.createElement('div')
    toast.className = 'fixed bottom-6 right-6 bg-green-500 text-white px-6 py-3 rounded-lg shadow-lg z-50 animate-slide-up'
    toast.textContent = message
    document.body.appendChild(toast)
    
    setTimeout(() => {
      toast.remove()
    }, 3000)
  }
</script>