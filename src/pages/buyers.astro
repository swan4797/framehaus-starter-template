---
// ========================================
// BUYERS PAGE
// Services page for property buyers
// Dynamic content from Stratos CRM
// ========================================

import Layout from '../layouts/Layout.astro'

// Static Page Components
import StaticPageLayout from '../components/static-page/layout/StaticPageLayout.astro'
import StaticHero from '../components/static-page/hero/StaticHero.astro'
import ShowcaseGrid from '../components/static-page/showcase/ShowcaseGrid.astro'
import ShowcaseCard from '../components/static-page/showcase/ShowcaseCard.astro'
import ContentSection from '../components/static-page/content/ContentSection.astro'
import ContentRow from '../components/static-page/content/ContentRow.astro'

// Page content utilities
import { getPageContent, hasSection } from '../lib/pages'

// Page configuration
import { buyersPageConfig } from '../components/static-page/config'

const pageTitle = 'Buying a Property'
const pageDescription = 'Find your perfect home with our expert guidance. We make buying a property simple and stress-free.'

// Fetch buyers page content from Stratos CRM
const pageContent = await getPageContent('buyers')

// Check which sections exist in CRM
const hasBuyerServices = hasSection(pageContent, 'buyer_services')
const hasBuyingProcess = hasSection(pageContent, 'buying_process')
const hasFirstTimeBuyers = hasSection(pageContent, 'first_time_buyers')
---

<Layout title={pageTitle} description={pageDescription}>
  <StaticPageLayout>
    <!-- Hero Section -->
    <StaticHero
      label={buyersPageConfig.hero.label}
      titleLines={buyersPageConfig.hero.titleLines}
      tagline="Whether you're a first-time buyer or looking for your forever home, we'll guide you through every step of the journey."
      ctaLabel={buyersPageConfig.hero.ctaLabel}
      ctaUrl={buyersPageConfig.hero.ctaUrl}
    />

    <!-- Showcase Section -->
    <ShowcaseGrid>
      <ShowcaseCard
        variant="blue"
        title="Find Your Dream Home"
        description="We'll match you with properties that fit your lifestyle, budget, and aspirations."
        features={[
          { text: 'Personalised Search' },
          { text: 'Local Area Expertise' },
          { text: 'First-Time Buyer Support' },
        ]}
        image="https://images.unsplash.com/photo-1560184897-ae75f418493e?w=600&h=400&fit=crop"
        imageAlt="Dream home"
      >
        <Fragment slot="icon">
          <div class="showcase__card-icon">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
              <polyline points="9 22 9 12 15 12 15 22"></polyline>
            </svg>
          </div>
        </Fragment>
      </ShowcaseCard>

      <ShowcaseCard
        variant="amber"
        subtitle="Expert Guidance"
        description="From your first viewing to picking up your keys, we're with you every step of the journey."
        image="https://images.unsplash.com/photo-1560520653-9e0e4c89eb11?w=400&h=500&fit=crop"
        imageAlt="Happy buyers"
        tallImage
      />
    </ShowcaseGrid>

    <!-- Content Section -->
    <ContentSection>
      <!-- Row 1: Buyer Services (block_key: buyer_services) -->
      <ContentRow
        label="Our Services"
        blockKey="buyer_services"
        pageContent={pageContent}
        title="How We Help Buyers"
      >
        {!hasBuyerServices && (
          <Fragment>
            <p class="content__text">
              Finding the right property can feel overwhelming, but it doesn't have to be. We take the time to understand exactly what you're looking for — your must-haves, your nice-to-haves, and your budget — so we can focus on properties that truly match your needs.
            </p>
            <p class="content__text">
              With our deep local knowledge, we can tell you about the neighbourhood, schools, transport links, and all the little details that make a house a home.
            </p>
          </Fragment>
        )}
      </ContentRow>

      <!-- Row 2: Buying Process (block_key: buying_process) -->
      <ContentRow
        label="The Process"
        blockKey="buying_process"
        pageContent={pageContent}
        title="The Buying Process"
        listItems={!hasBuyingProcess ? [
          'Personalised property matching',
          'Flexible viewing arrangements',
          'Expert negotiation on your behalf',
          'Mortgage broker introductions',
          'Solicitor recommendations',
          'Regular progress updates',
        ] : []}
      >
        {!hasBuyingProcess && (
          <p class="content__text">
            From your first viewing to picking up your keys, we're with you every step of the way. Our team provides guidance and support throughout the entire buying process.
          </p>
        )}
      </ContentRow>

      <!-- Row 3: First Time Buyers (block_key: first_time_buyers) -->
      <ContentRow
        label="First-Time Buyers"
        blockKey="first_time_buyers"
        pageContent={pageContent}
        title="First Time Buyers"
      >
        {!hasFirstTimeBuyers && (
          <Fragment>
            <p class="content__text">
              Buying your first home is exciting but can also feel daunting. We specialise in helping first-time buyers navigate the process with confidence, explaining everything in plain English and ensuring you feel comfortable at every stage.
            </p>
            <p class="content__text">
              We can also advise on government schemes like Help to Buy and Shared Ownership that might help you get onto the property ladder sooner.
            </p>
          </Fragment>
        )}
      </ContentRow>

      <!-- Row 4: CTA -->
      <ContentRow
        label="Get Started"
        title="Ready to find your new home?"
        isCta
        actions={[
          { label: 'Search Properties', url: '/search?listing_type=sale', variant: 'primary', icon: true },
          { label: 'Register Interest', url: '/contact', variant: 'secondary' },
        ]}
      >
        <p class="content__text">
          Register with us today and be the first to hear about properties that match your criteria. Our team is ready to help you find your perfect home.
        </p>
      </ContentRow>
    </ContentSection>
  </StaticPageLayout>
</Layout>

<style lang="scss">
  @use '../styles/variables' as *;

  // Fallback content text styling
  .content__text {
    font-size: 1.0625rem;
    color: $text-secondary;
    line-height: 1.75;
    margin: 0 0 20px 0;

    &:last-child {
      margin-bottom: 0;
    }
  }
</style>
